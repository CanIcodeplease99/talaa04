class PaymentsController < ApplicationController; def transfer; amount_cents=(params[:amount].to_f*100).to_i; receiver_id=1002; s=Settlement.create!(transfer_id: "tr_#{SecureRandom.hex(6)}", from_user: current_user_id, to_user: receiver_id, amount_cents: amount_cents, currency: "GHS", rail: "gh_domestic", status: "queued", meta:{msisdn:"+233555000111", network:"MTN"}); SettlementWorker.perform_async(s.transfer_id); render json:{id:s.transfer_id,status:s.status}, status: :created; end; def transfer_international; src=(params[:source_currency]||'USD').upcase; tgt='GHS'; amt=params[:amount].to_f; rate=(params[:rate]||14.50).to_f; fee=(params[:fee]|| (amt*0.01)).to_f; received=((amt-fee)*rate).round(2); received_cents=(received*100).to_i; s=Settlement.create!(transfer_id:"tr_intl_#{SecureRandom.hex(6)}", from_user:current_user_id, to_user:1002, amount_cents:received_cents, currency:tgt, rail:"fx_partner", status:"queued", funding_source:"stripe", funding_status:"pending"); FxSettlementWorker.perform_async(s.transfer_id, {src_currency:src, tgt_currency:tgt, src_amount:amt}); render json:{id:s.transfer_id, status:'sent', received_ghs:received}, status: :created; end; end
