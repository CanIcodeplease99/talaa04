module Gateway; class DomesticRouter; ORDER=%w[nsano zeepay hubtel]; def transfer_mobile_money(msisdn:, network:, amount_cents:, reference:, idempotency_key:); ORDER.each do |name|; client={"nsano"=>NsanoClient.new,"zeepay"=>ZeepayClient.new,"hubtel"=>HubtelClient.new}[name]; resp=client.payout_momo(msisdn:msisdn, network:network, amount_cents:amount_cents, reference:reference); return {provider:name, status:resp[:status], ok:resp[:ok], raw:resp[:raw]} if resp[:ok]; end; {provider:"nsano", status:"failed", ok:false, error:"no provider available"}; end; end; end
