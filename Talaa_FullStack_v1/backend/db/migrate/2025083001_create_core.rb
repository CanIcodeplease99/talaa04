class CreateCore < ActiveRecord::Migration[7.1]; def change; create_table :balances do |t|; t.bigint :user_id; t.string :currency; t.bigint :amount_cents, default:0; t.timestamps; end; create_table :ledger_entries do |t|; t.bigint :user_id; t.string :direction; t.bigint :amount_cents; t.string :currency; t.string :reason; t.string :ref_id; t.jsonb :meta, default:{}; t.timestamps; end; create_table :settlements do |t|; t.string :transfer_id; t.bigint :from_user; t.bigint :to_user; t.bigint :amount_cents; t.string :currency; t.string :rail; t.string :status, default:'queued'; t.integer :attempts, default:0; t.string :last_error; t.string :funding_source, default:'stripe'; t.string :funding_status, default:'pending'; t.datetime :expected_settlement_at; t.jsonb :meta, default:{}; t.timestamps; t.index :transfer_id, unique:true; end; create_table :company_floats do |t|; t.string :currency; t.bigint :amount_cents, default:0; t.timestamps; end; create_table :funding_intents do |t|; t.bigint :user_id; t.string :currency; t.bigint :amount_cents; t.string :provider, default:'stripe'; t.string :provider_pi_id; t.integer :status, default:0; t.string :transfer_id; t.timestamps; end; end; end
