import 'package:flutter/material.dart'; import '../services/api.dart'; class SendScreen extends StatefulWidget{ final String apiBase; const SendScreen({super.key, required this.apiBase}); @override State<SendScreen> createState()=>_SendScreenState(); } class _SendScreenState extends State<SendScreen>{ final controller=TextEditingController(); bool sending=false; Future<void> confirm(bool instant) async{ final amt=double.tryParse(controller.text.trim())??0; if(amt<=0) return; setState(()=>sending=true); try{ final api=TalaaApi(widget.apiBase); final res=await api.sendDomestic(amount: amt, instant: instant); if(!mounted) return; showDialog(context: context, builder: (_)=> AlertDialog(title: const Text('Payment sent'), content: Text('Transfer ${res['id']} • speed: ${res['speed']}'))); }catch(e){ if(!mounted) return; showDialog(context: context, builder: (_)=> AlertDialog(title: const Text('Error'), content: Text(e.toString()))); }finally{ if(mounted) setState(()=>sending=false); } } void openConfirm(){ final amt=controller.text.trim(); showModalBottomSheet(context: context, builder: (_)=> SafeArea(child: Padding(padding: const EdgeInsets.all(16), child: Column(mainAxisSize: MainAxisSize.min, children:[ Text('Send GHS $amt', style: const TextStyle(fontSize:18, fontWeight: FontWeight.bold)), const SizedBox(height:12), Row(children:[ Expanded(child: ElevatedButton(onPressed: ()=>confirm(true), child: const Text('Send instantly'))), const SizedBox(width:12), OutlinedButton(onPressed: ()=>confirm(false), child: const Text('Standard')), ]), const SizedBox(height:8), const Text('Instant feels immediate; settlement completes in background.', style: TextStyle(fontSize:12)) ]),))); } @override Widget build(BuildContext c){ return Scaffold(appBar: AppBar(title: const Text('Send')), body: Padding(padding: const EdgeInsets.all(16), child: Column(crossAxisAlignment: CrossAxisAlignment.start, children:[ const Text('Amount (GHS)', style: TextStyle(fontWeight: FontWeight.w600)), const SizedBox(height:8), TextField(controller: controller, keyboardType: TextInputType.number, decoration: const InputDecoration(hintText:'25.00')), const SizedBox(height:16), SizedBox(width: double.infinity, child: ElevatedButton(onPressed: sending?null:openConfirm, child: Text(sending?'Sending…':'Send'))), ]))); }}
